{%load static%}
<!-- jQuery -->
<script src="{% static 'dashproject/admin-lte/plugins/jquery/jquery.min.js'%}"></script>
<!-- jQuery UI 1.11.4 -->
<script src="{% static 'dashproject/admin-lte/plugins/jquery-ui/jquery-ui.min.js'%}"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
<script>
  $.widget.bridge("uibutton", $.ui.button);
</script>
<!-- Bootstrap 4 -->
<script src="{% static 'dashproject/admin-lte/plugins/bootstrap/js/bootstrap.bundle.min.js'%}"></script>
<!-- ChartJS -->
<script src="{% static 'dashproject/admin-lte/plugins/chart.js/Chart.min.js'%}"></script>
<!-- Sparkline -->
<script src="{% static 'dashproject/admin-lte/plugins/sparklines/sparkline.js'%}"></script>
<!-- JQVMap -->
<script src="{% static 'dashproject/admin-lte/plugins/jqvmap/jquery.vmap.min.js'%}"></script>
<script src="{% static 'dashproject/admin-lte/plugins/jqvmap/maps/jquery.vmap.usa.js'%}"></script>
<!-- jQuery Knob Chart -->
<script src="{% static 'dashproject/admin-lte/plugins/jquery-knob/jquery.knob.min.js'%}"></script>
<!-- daterangepicker -->
<script src="{% static 'dashproject/admin-lte/plugins/moment/moment.min.js'%}"></script>
<script src="{% static 'dashproject/admin-lte/plugins/daterangepicker/daterangepicker.js'%}"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="{% static 'dashproject/admin-lte/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js'%}"></script>
<!-- Summernote -->
<script src="{% static 'dashproject/admin-lte/plugins/summernote/summernote-bs4.min.js'%}"></script>
<!-- overlayScrollbars -->
{% comment %}
<script src="{% static 'dashproject/admin-lte/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js'%}"></script>
{% endcomment %}
<!-- AdminLTE App -->
<script src="{% static 'dashproject/admin-lte/dist/js/adminlte.js'%}"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="{% static 'dashproject/admin-lte/dist/js/pages/dashboard.js'%}"></script>
<!-- AdminLTE for demo purposes -->
<script src="{% static 'dashproject/admin-lte/dist/js/demo.js'%}"></script>

<!-- DataTables  & Plugins -->
<script src="{% static 'dashproject/admin-lte/plugins/datatables/jquery.dataTables.min.js'%}"></script>
<script src="{% static 'dashproject/admin-lte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js'%}"></script>
<script src="{% static 'dashproject/admin-lte/plugins/datatables-responsive/js/dataTables.responsive.min.js'%}"></script>
<script src="{% static 'dashproject/admin-lte/plugins/datatables-responsive/js/responsive.bootstrap4.min.js'%}"></script>
<script src="{% static 'dashproject/admin-lte/plugins/datatables-buttons/js/dataTables.buttons.min.js'%}"></script>
<script src="{% static 'dashproject/admin-lte/plugins/datatables-buttons/js/buttons.bootstrap4.min.js'%}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.4/jquery-confirm.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>

<script>
  $(document).ready(function () {
    $("#CheckTwoStep").click(function (e) {
      e.preventDefault();
      var btn = $(this);
      var url = btn.data("url");
      var param = {
        url: url,
        form: $("#login-form"),
      };
      AjaxCheckTwoStepVerification(param);
    });
  });

  function AjaxCheckTwoStepVerification(param) {
    $.ajax({
      url: param.url,
      type: "POST",
      async: true,
      data: param.form.serialize(),
      success: function (data) {
        if (data.is_valid) {
          $.confirm({
            title: "Two Step Verification",
            content:
              '<div class="form-group">' +
              "<label>Verification Code: </label>" +
              '<input name="code" type="text" placeholder="Code" class="code form-control" required />' +
              "</div>",
            type: "orange",
            buttons: {
              verify: function () {
                var code = this.$content.find(".code").val();
                if (!code) {
                  $.alert("Provide a valid code");
                  return false;
                }

                $.ajax({
                  url: param.url,
                  type: "PUT",
                  async: true,
                  data: param.form.serialize() + "&code=" + code,
                  beforeSend: function (xhr) {
                    xhr.setRequestHeader("X-CSRFToken", $.cookie("csrftoken"));
                  },
                  success: function (data) {
                    if (data.is_valid) {
                      window.location.href = "{% url 'records' %}"; // Change 'index' to the name of your index URL
                    } else {
                      $.alert(data.message);
                    }
                  },
                  error: function () {
                    $.alert("Error occurred");
                  },
                });
              },
              cancel: function () {},
            },
          });
        } else {
          param.form.submit();
        }
      },
      error: function () {
        showMessage("warning", "Error occurred");
      },
    });
  }
</script>
