{% extends 'dashproject/base/layout.html' %} {% load static %} {% block content%}
<div class="container-fluid">
  <div class="row content-home">
    <div class="col">
      <h6>
        <audio id="music">
          <source src="{%static 'dashproject/record/uri1.wav'%}" type="audio/mp3">
      </audio>
      
      <!-- button to play/pause 
      <button onclick="togglePlayPause()" type="button" id="playPauseBtn">
          Play
          <i class="fas fa-solid fas fa-play" id="playPauseIcon"></i>
      </button>-->
      
      <!-- button to mute 
      <button onclick="muteAudio()" type="button">
          Mute
          <i class="fas fa-solid fas fa-volume-xmark"></i>
      </button>-->
      
      <!-- display play sequence time and file name
      <div id="info">
          <p>File Name: <span id="fileName"></span></p>
          <p>Current Time: <span id="currentTime">0:00</span></p>
      </div> -->
        Web and Records<span class="badge badge-primary m-2"> {{ records_count }} </span>
      </h6>
      <table class="table mt-2 table-bordered table-hover" id="example2">
        <thead>
          <tr>
            <th>Source ID</th>
            <th>Source Type</th>
            <th>Date Created</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for record in call_web %}
          {% if record.status.name == 'Report Waiting'%}
          <tr class="mt-2">
            <td><a href="#">{{record.id}}</a></td>
            <td>{{ record.type }}</td>
            <td><time datetime="">{{ record.date_created}}</time></td>
            <td>{{record.status.name}}</td>
            {% if record.type == 'webform' %}
              <td>
                <button
                  type="button"
                  class="btn btn-transparent dropdown-toggle text-uppercase"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  Actions
                </button>
                <div class="dropdown-menu">
                  <button
                    type="button"
                    class="btn btn-transparent p-3 text-uppercase view-subject-btn fas fa-eye"
                    data-id="{{record.webform.id}}"
                    data-toggle="modal"
                    data-target="#modal-subject"
                    onclick="setModalCallId('{{ record.id}}')"
                  >
                    View
                  </button>
                
                  <!-- <a
                    class="dropdown-item view-subject-btn"
                    href="subject_details/{{record.subject.id}}"
                    ><i class="fas fa-eye"></i> View</a>
                   -->
                 
                </div>
              </td>

              {%else%}  
              <td>
                <button
                  type="button"
                  class="btn btn-transparent dropdown-toggle text-uppercase"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  Actions
                </button>
                <div class="dropdown-menu">
                  <button
                    type="button"
                    class="btn btn-transparent p-3 text-uppercase view-subject-btn fas fa-eye"
                    data-id="{{record.records_source.id}}"
                    data-toggle="modal"
                    data-target="#modal-default"
                    onclick="setModalWebId('{{ record.id }}')"
                  >
                    View
                  </button>
                 
                  {% comment %}
                  <a
                    class="dropdown-item view-subject-btn"
                    href="record_details/{{ record.records_source.id }}"
                    ><i class="fas fa-eye"></i> View</a>
                  >
                  {% endcomment %}
                </div>
              </td>


            {%endif%}
          </tr>
          {%endif%}
        {% endfor %}
        
        </tbody>
      </table>
    </div>
  </div>

  <!-- Modal -->
  <div
    class="modal fade"
    id="modal-default"
    tabindex="-1"
    role="dialog"
    aria-labelledby="modal-default-label"
    aria-hidden="true"
  >
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modal-default-label">Record</h5>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="card">
            <p><strong>Record Name</strong></p>
            <span class="subject-first-name"></span>
            
           <!-- <p><strong>Last Name</strong></p>
            <span class="subject-last-name"></span> -->
            <!--  <p><strong>Gender</strong></p>
            <span class="subject-gender"></span> -->
          </div>
          <button onclick="togglePlayPause()" type="button" id="playPauseBtn">
            Play
            <i class="fas fa-solid fas fa-play" id="playPauseIcon"></i>
        </button>
        
        <!-- button to mute -->
        <button onclick="muteAudio()" type="button">
            Mute
            <i class="fas fa-solid fas fa-volume-xmark"></i>
        </button>
        <div id="info">
          <p>File Name: <span id="fileName"></span></p>
          <p>Current Time: <span id="currentTime">0:00</span></p>
      </div> 
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">
            Close
          </button>
          <a href="#" id="modalReportLink" class="btn btn-primary">
            Report to
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!--Modal for Subject details-->
 <!-- Modal -->
 <div
 class="modal fade"
 id="modal-subject"
 tabindex="-1"
 role="dialog"
 aria-labelledby="modal-default-label"
 aria-hidden="true"
>
 <div class="modal-dialog" role="document">
   <div class="modal-content">
     <div class="modal-header">
       <h5 class="modal-title text-success" id="modal-default-label">Subject - Web form</h5>
       <button
         type="button"
         class="close"
         data-dismiss="modal"
         aria-label="Close"
       >
         <span aria-hidden="true">&times;</span>
       </button>
     </div>
     <div class="modal-body">
       <div class="card">
        <p class="text-mute">First name</p>
          <p> <strong><span id="name-data"></span></strong></p>
        <p class="text-mute">Last name</p>
        <p> <strong><span id="last-data"></span></strong></p>
        <p class="text-mute">Gender</p>
        <div class="row">
          <div class="col">  <input type="radio" id="gender-male" name="gender" value="M"> Male<br></div>
          <div class="col"><input type="radio" id="gender-female" name="gender" value="F"> Female</div>
        </div>
        <p class="text-mute">Date of birth</p>
        <p> <strong><span id="dob-data"></span></strong></p>
        <p class="text-mute">Nationality</p>
        <p> <strong><span id="nat-data"></span></strong></p>
        <p class="text-mute">Identification</p>
        <p> <strong><span id="id-type-data"></span></strong></p>
        <p class="text-mute">ID Number</p>
        <p> <strong><span id="id-number-data"></span></strong></p>
        <p class="text-mute">Home Address</p>
        <p> <strong><span id="home-address-data"></span></strong></p>
        <p class="text-mute">Bussiness Name</p>
        <p> <strong><span id="business-name-data"></span></strong></p>
        <p class="text-mute">Bussiness Address</p>
        <p> <strong><span id="business-address-data"></span></strong></p>
        <p class="text-mute">Bin or TIN</p>
        <p> <strong><span id="bin-tin-data"></span></strong></p>
        <p class="text-mute">Telephone</p>
        <p> <strong><span id="telephone-data"></span></strong></p>
        <p class="text-mute">Description</p>
        <p> <strong><span id="description-data"></span></strong></p>
        <p class="text-mute">Conveyance</p>
        <p> <strong><span id="last-data"></span></strong></p>
        <p class="text-mute">Conveyance Description</p>
        <p> <strong><span id="conveyance-description-data"></span></strong></p>
        
       </div>
     </div>
     <div class="modal-footer">
       <button type="button" class="btn btn-secondary" data-dismiss="modal">
         Close
       </button>
       <a href="#" id="modalSubjectReportLink" class="btn btn-primary">Report to Test</a>
       <!-- <button type="button" class="btn btn-primary">Report To</button> -->
     </div>
   </div>
 </div>
</div>
</div>

<script>
   //get element from HTML
   var audioT = document.getElementById("music");
   var playPauseBtn = document.getElementById("playPauseBtn");
   var playPauseIcon = document.getElementById("playPauseIcon");
   var fileName = document.getElementById("fileName");
   var currentTime = document.getElementById("currentTime");

   // set the file name 
   fileName.innerText = "uri1.wav";

   // function to toggle play/pause
   function togglePlayPause() {
       if (audioT.paused) {
           audioT.play();
           playPauseBtn.innerText = "Pause";
           playPauseIcon.className = "fas fa-solid fas fa-pause";
       } else {
           audioT.pause();
           playPauseBtn.innerText = "Play";
           playPauseIcon.className = "fas fa-solid fas fa-play";
       }
   }

   // function to mute/unmute audio
   function muteAudio() {
       audioT.muted = !audioT.muted;
   }

   // function to format time
   function formatTime(seconds) {
       const minutes = Math.floor(seconds / 60);
       const secs = Math.floor(seconds % 60);
       return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
   }

   // update current time display
   audioT.addEventListener('timeupdate', function() {
       currentTime.innerText = formatTime(audioT.currentTime);
   });


   function setModalWebId(webId) {
    if (webId) {
      var reportLink = document.getElementById('modalReportLink');
      reportLink.href = "{% url 'report-web' 0 %}".replace("0", webId);
    } else {
      console.log("Bug")
    }
  }

  function setModalCallId(webId) {
    if (webId) {
      //var reportLink = document.getElementById('modalReportLink');
      var reportLink = document.getElementById('modalSubjectReportLink')
      reportLink.href = "{% url 'report-web' 0 %}".replace("0", webId);
    } else {
     console.log("Bug")
    }
  }
</script>
{% endblock %}
